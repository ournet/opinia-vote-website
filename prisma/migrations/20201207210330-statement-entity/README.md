# Migration `20201207210330-statement-entity`

This migration has been generated by Dumitru C. at 12/7/2020, 11:03:30 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "statement_entities" (
"id" SERIAL,
    "statement_id" INTEGER NOT NULL,
    "entity_id" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "statement_entities.entity_id_statement_id_unique" ON "statement_entities"("entity_id", "statement_id")

CREATE INDEX "statement_entities.statement_id_index" ON "statement_entities"("statement_id")

CREATE INDEX "statement_entities.entity_id_index" ON "statement_entities"("entity_id")

ALTER TABLE "statement_entities" ADD FOREIGN KEY("entity_id")REFERENCES "entities"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "statement_entities" ADD FOREIGN KEY("statement_id")REFERENCES "statements"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201207205325-init..20201207210330-statement-entity
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model StatementVote {
   id          Int @id @default(autoincrement())
@@ -24,8 +24,24 @@
   @@index([userId])
   @@map("statement_votes")
 }
+model StatementEntity {
+  id          Int @id @default(autoincrement())
+  statementId Int @map("statement_id")
+  entityId    Int @map("entity_id")
+
+  createdAt DateTime @default(now()) @map("created_at")
+
+  entity    Entity    @relation(fields: [entityId], references: [id])
+  statement Statement @relation(fields: [statementId], references: [id])
+
+  @@unique([entityId, statementId])
+  @@index([statementId])
+  @@index([entityId])
+  @@map("statement_entities")
+}
+
 model Statement {
   id           Int           @id @default(autoincrement())
   text         String
   languageCode String        @map("language_code")
@@ -37,10 +53,11 @@
   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")
-  author Entity          @relation(fields: [authorId], references: [id])
-  votes  StatementVote[]
+  author   Entity            @relation(fields: [authorId], references: [id])
+  votes    StatementVote[]
+  entities StatementEntity[]
   @@index([authorId])
   @@index([languageCode, createdAt])
   @@index([authorId, languageCode])
@@ -67,9 +84,10 @@
   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @updatedAt @map("updated_at")
-  statements Statement[]
+  statements        Statement[]
+  statementEntities StatementEntity[]
   @@unique([name, languageCode])
   @@unique([slug, languageCode])
   @@index([name])
   @@index([languageCode])
```


