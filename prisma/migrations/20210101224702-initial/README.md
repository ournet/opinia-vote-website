# Migration `20210101224702-initial`

This migration has been generated by Dumitru C. at 1/2/2021, 12:47:02 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "StatementType" AS ENUM ('PROMISE', 'INFO', 'STATEMENT')

CREATE TYPE "EntityType" AS ENUM ('PERSON', 'PLACE', 'ORG', 'EVENT')

CREATE TABLE "statement_votes" (
"id" SERIAL,
    "statement_id" INTEGER NOT NULL,
    "user_id" INTEGER NOT NULL,
    "points" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "statement_entities" (
"id" SERIAL,
    "statement_id" INTEGER NOT NULL,
    "entity_id" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("id")
)

CREATE TABLE "statements" (
"id" SERIAL,
    "text" TEXT NOT NULL,
    "language_code" TEXT NOT NULL,
    "country_code" TEXT,
    "author_id" INTEGER NOT NULL,
    "question" TEXT NOT NULL,
    "source_url" TEXT,
    "type" "StatementType" NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "entities" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "slug" TEXT NOT NULL,
    "type" "EntityType" NOT NULL,
    "fullName" TEXT,
    "abbr" TEXT,
    "language_code" TEXT NOT NULL,
    "country_code" TEXT,
    "wikipedia_url" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "users" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "email_verified" TIMESTAMP(3),
    "image" TEXT,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "accounts" (
"id" SERIAL,
    "compound_id" TEXT NOT NULL,
    "user_id" INTEGER NOT NULL,
    "provider_type" TEXT NOT NULL,
    "provider_id" TEXT NOT NULL,
    "provider_account_id" TEXT NOT NULL,
    "refresh_token" TEXT,
    "access_token" TEXT,
    "access_token_expires" TIMESTAMP(3),
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "sessions" (
"id" SERIAL,
    "user_id" INTEGER NOT NULL,
    "expires" TIMESTAMP(3) NOT NULL,
    "session_token" TEXT NOT NULL,
    "access_token" TEXT NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "statement_votes.user_id_statement_id_unique" ON "statement_votes"("user_id", "statement_id")

CREATE INDEX "statement_votes.statement_id_index" ON "statement_votes"("statement_id")

CREATE INDEX "statement_votes.user_id_index" ON "statement_votes"("user_id")

CREATE UNIQUE INDEX "statement_entities.entity_id_statement_id_unique" ON "statement_entities"("entity_id", "statement_id")

CREATE INDEX "statement_entities.statement_id_index" ON "statement_entities"("statement_id")

CREATE INDEX "statement_entities.entity_id_index" ON "statement_entities"("entity_id")

CREATE INDEX "statements.author_id_index" ON "statements"("author_id")

CREATE INDEX "statements.language_code_created_at_index" ON "statements"("language_code", "created_at")

CREATE INDEX "statements.author_id_language_code_index" ON "statements"("author_id", "language_code")

CREATE UNIQUE INDEX "entities.name_language_code_unique" ON "entities"("name", "language_code")

CREATE UNIQUE INDEX "entities.slug_language_code_unique" ON "entities"("slug", "language_code")

CREATE INDEX "entities.name_index" ON "entities"("name")

CREATE INDEX "entities.language_code_index" ON "entities"("language_code")

CREATE UNIQUE INDEX "users.email_unique" ON "users"("email")

CREATE UNIQUE INDEX "accounts.compound_id_unique" ON "accounts"("compound_id")

CREATE INDEX "userId" ON "accounts"("user_id")

CREATE INDEX "providerId" ON "accounts"("provider_id")

CREATE INDEX "providerAccountId" ON "accounts"("provider_account_id")

CREATE UNIQUE INDEX "sessions.session_token_unique" ON "sessions"("session_token")

CREATE UNIQUE INDEX "sessions.access_token_unique" ON "sessions"("access_token")

ALTER TABLE "statement_votes" ADD FOREIGN KEY("user_id")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "statement_votes" ADD FOREIGN KEY("statement_id")REFERENCES "statements"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "statement_entities" ADD FOREIGN KEY("entity_id")REFERENCES "entities"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "statement_entities" ADD FOREIGN KEY("statement_id")REFERENCES "statements"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "statements" ADD FOREIGN KEY("author_id")REFERENCES "entities"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20210101224702-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,148 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model StatementVote {
+  id          Int @id @default(autoincrement())
+  statementId Int @map("statement_id")
+  userId      Int @map("user_id")
+  points      Int
+
+  createdAt DateTime @default(now()) @map("created_at")
+  updatedAt DateTime @updatedAt @map("updated_at")
+
+  user      User      @relation(fields: [userId], references: [id])
+  statement Statement @relation(fields: [statementId], references: [id])
+
+  @@unique([userId, statementId])
+  @@index([statementId])
+  @@index([userId])
+  @@map("statement_votes")
+}
+
+model StatementEntity {
+  id          Int @id @default(autoincrement())
+  statementId Int @map("statement_id")
+  entityId    Int @map("entity_id")
+
+  createdAt DateTime @default(now()) @map("created_at")
+
+  entity    Entity    @relation(fields: [entityId], references: [id])
+  statement Statement @relation(fields: [statementId], references: [id])
+
+  @@unique([entityId, statementId])
+  @@index([statementId])
+  @@index([entityId])
+  @@map("statement_entities")
+}
+
+model Statement {
+  id           Int           @id @default(autoincrement())
+  text         String
+  languageCode String        @map("language_code")
+  countryCode  String?       @map("country_code")
+  authorId     Int           @map("author_id")
+  question     String
+  sourceUrl    String?       @map("source_url")
+  type         StatementType
+
+  createdAt DateTime @default(now()) @map("created_at")
+  updatedAt DateTime @updatedAt @map("updated_at")
+
+  author   Entity            @relation(fields: [authorId], references: [id])
+  votes    StatementVote[]
+  entities StatementEntity[]
+
+  @@index([authorId])
+  @@index([languageCode, createdAt])
+  @@index([authorId, languageCode])
+  @@map("statements")
+}
+
+enum StatementType {
+  PROMISE
+  INFO
+  STATEMENT
+}
+
+model Entity {
+  id           Int        @id @default(autoincrement())
+  name         String
+  slug         String
+  type         EntityType
+  fullName     String?
+  // Abbreviation
+  abbr         String?
+  languageCode String     @map("language_code")
+  countryCode  String?    @map("country_code")
+  wikipediaUrl String?    @map("wikipedia_url")
+
+  createdAt DateTime @default(now()) @map("created_at")
+  updatedAt DateTime @updatedAt @map("updated_at")
+
+  statements        Statement[]
+  statementEntities StatementEntity[]
+  @@unique([name, languageCode])
+  @@unique([slug, languageCode])
+  @@index([name])
+  @@index([languageCode])
+  @@map("entities")
+}
+
+enum EntityType {
+  PERSON
+  PLACE
+  ORG
+  EVENT
+}
+
+// ---- users
+
+model User {
+  id            Int       @id @default(autoincrement())
+  name          String
+  email         String    @unique
+  emailVerified DateTime? @map("email_verified")
+  image         String?
+  createdAt     DateTime  @default(now()) @map("created_at")
+  updatedAt     DateTime  @updatedAt @map("updated_at")
+
+  votes StatementVote[]
+  @@map("users")
+}
+
+model Account {
+  id                 Int       @id @default(autoincrement())
+  compoundId         String    @unique @map("compound_id")
+  userId             Int       @map("user_id")
+  providerType       String    @map("provider_type")
+  providerId         String    @map("provider_id")
+  providerAccountId  String    @map("provider_account_id")
+  refreshToken       String?   @map("refresh_token")
+  accessToken        String?   @map("access_token")
+  accessTokenExpires DateTime? @map("access_token_expires")
+  createdAt          DateTime  @default(now()) @map("created_at")
+  updatedAt          DateTime  @updatedAt @map("updated_at")
+
+  @@index([userId], name: "userId")
+  @@index([providerId], name: "providerId")
+  @@index([providerAccountId], name: "providerAccountId")
+  @@map("accounts")
+}
+
+model Session {
+  id           Int      @id @default(autoincrement())
+  userId       Int      @map("user_id")
+  expires      DateTime
+  sessionToken String   @unique @map("session_token")
+  accessToken  String   @unique @map("access_token")
+  createdAt    DateTime @default(now()) @map("created_at")
+  updatedAt    DateTime @updatedAt @map("updated_at")
+
+  @@map("sessions")
+}
```


